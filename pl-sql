DECLARE 
    pass_id booking.passengerid%type;
    points_used booking.pointsused%type;
    ticket_price schedule.ticketprice%type;
    ticket_points passenger.subscriptionpoints%type;
    schedule_id booking.scheduleid%type;
    current_points passenger.subscriptionpoints%type;
    sub_id passenger.subscriptionid%type;
    sub_points subscription.subscriptionpointsfree%type;
    sub_rank subscription.subscriptionmembershiprank%type;
BEGIN
    SELECT passengerid, pointsused, scheduleid
        INTO pass_id, points_used, schedule_id
        FROM booking
        WHERE bookingnumber=5;
    SELECT subscriptionpoints, subscriptionid
        INTO current_points, sub_id
        FROM passenger
        WHERE passengerid = pass_id;
    SELECT subscriptionpointsfree, subscriptionmembershiprank
        INTO sub_points, sub_rank
        FROM subscription
        WHERE subscriptionid = sub_id;
    SELECT ticketprice
        INTO ticket_price
        FROM schedule
        WHERE scheduleid = schedule_id;
        ticket_points := ticket_price * 10;
    DBMS_OUTPUT.PUT_LINE('Your current applicable points: ' || current_points);
    DBMS_OUTPUT.PUT_LINE('Minimum points needed by a ' || sub_rank || ' member to be eligible for a free ticket: ' || sub_points);
    IF points_used = 'T' AND current_points >= sub_points THEN
        UPDATE passenger
        SET subscriptionpoints = current_points - ticket_points
        WHERE passengerid = pass_id;
        SELECT subscriptionpoints
        INTO current_points
        FROM passenger
        WHERE passengerid = pass_id;
        DBMS_OUTPUT.PUT_LINE('You have successfully used your points to purchase this ticket. Remaining points: ' || current_points);
    ELSIF current_points < ticket_points THEN
        DBMS_OUTPUT.PUT_LINE('You do not have enough points! This purchase cannot be completed using points, you will be billed.');
        UPDATE booking
        SET pointsused = 'F'
        WHERE bookingnumber = 5;
    END IF;
END;
